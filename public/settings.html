<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <title>Ping Identity - Configuration</title>
    <!-- Using jsDelivr for Font Awesome with explicit version -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <!-- Tippy.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6.3.7/dist/tippy.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/png" href="images/logo.png">
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo-container">
          <button type="button" class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation">
            <i class="fas fa-bars" aria-hidden="true"></i>
          </button>
          <img src="images/logo.png" alt="Ping Identity Logo" class="logo" width="40" height="40">
          <h1>Configuration</h1>
        </div>
      </div>
    </header>

    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay" aria-hidden="true"></div>

    <!-- App Container for Push Behavior -->
    <div class="app-container">
      <!-- Navigation -->
      <nav class="sidebar" aria-label="Main navigation">
        <div class="nav-logo">
          <img src="images/logo.png" alt="Ping Identity Logo" class="nav-logo-img" width="40" height="40">
        </div>
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="index.html" class="nav-link">
              <i class="fas fa-users nav-icon" aria-hidden="true"></i>
              <span>User Management</span>
            </a>
          </li>
          <li class="nav-item nav-dropdown">
            <button type="button" class="nav-link nav-dropdown-toggle" id="quick-actions-toggle" aria-expanded="false" aria-controls="quick-actions-menu">
              <i class="fas fa-bolt nav-icon" aria-hidden="true"></i>
              <span>Quick Actions</span>
              <i class="fas fa-chevron-down nav-arrow" aria-hidden="true"></i>
            </button>
            <ul class="nav-submenu" id="quick-actions-menu" aria-labelledby="quick-actions-toggle">
              <li class="nav-submenu-item">
                <a href="index.html#import-panel" class="nav-submenu-link quick-action" data-action="import">
                  <i class="fas fa-upload nav-icon" aria-hidden="true"></i>
                  <span>Import Users</span>
                </a>
              </li>
              <li class="nav-submenu-item">
                <a href="index.html#delete-panel" class="nav-submenu-link quick-action" data-action="delete-bulk">
                  <i class="fas fa-trash-alt nav-icon" aria-hidden="true"></i>
                  <span>Delete Bulk Users</span>
                </a>
              </li>
              <li class="nav-submenu-item">
                <a href="index.html#delete-panel" class="nav-submenu-link quick-action" data-action="delete-single">
                  <i class="fas fa-user-times nav-icon" aria-hidden="true"></i>
                  <span>Delete Single User</span>
                </a>
              </li>
              <li class="nav-submenu-item">
                <a href="index.html#modify-panel" class="nav-submenu-link quick-action" data-action="modify">
                  <i class="fas fa-edit nav-icon" aria-hidden="true"></i>
                  <span>Modify Users</span>
                </a>
              </li>
            </ul>
          </li>
        </ul>
        <div class="sidebar-footer">
          <a href="settings.html" class="nav-link active" aria-current="page">
            <i class="fas fa-cog nav-icon" aria-hidden="true"></i>
            <span>Configuration</span>
          </a>
        </div>
      </nav>

        <!-- Main Content -->
        <main class="main-content">
            <h1>Configuration</h1>

            <!-- Authentication Configuration Group -->
            <section class="config-group" id="auth-config">
                <div class="group-header">
                    <h2>Authentication Configuration</h2>
                </div>
                <div class="group-content">
                    <form id="credentials-form" class="form compact-form">
                        <div class="form-group">
                            <label for="environment-id" class="with-tooltip">
                                Environment ID
                                <span class="tooltip-icon" data-tippy-content="Your PingOne environment identifier.">i</span>
                            </label>
                            <input type="text" id="environment-id" name="environmentId" class="input-wide" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="client-id" class="with-tooltip">
                                Client ID
                                <span class="tooltip-icon" data-tippy-content="Your PingOne application's client identifier.">i</span>
                            </label>
                            <input type="text" id="client-id" name="clientId" class="input-wide" required>
                        </div>
                        
                        <div class="form-group client-secret-group">
                            <label for="client-secret" class="with-tooltip">
                                Client Secret
                                <span class="tooltip-icon" data-tippy-content="Your PingOne application's client secret. Omit if not required.">i</span>
                            </label>
                            <div class="input-with-icon">
                                <input type="password" id="client-secret" name="clientSecret" class="input-wide">
                                <i class="fas fa-eye" id="toggle-secret"></i>
                            </div>
                        </div>
                        
                        <!-- Advanced Settings Section (Collapsible) -->
                        <div class="advanced-accordion">
                            <button class="advanced-accordion__button" id="advanced-toggle" aria-expanded="false" aria-controls="advanced-content">
                                <span class="advanced-accordion__title">Advanced Settings</span>
                                <span class="advanced-accordion__icon" aria-hidden="true"></span>
                            </button>
                            <div class="advanced-accordion__content" id="advanced-content" role="region" aria-labelledby="advanced-toggle">
                                <div class="form-group">
                                    <label for="auth-region" class="with-tooltip">
                                        Authentication Region
                                        <span class="tooltip-icon" data-tippy-content="Select your PingOne authentication region or specify a custom domain">i</span>
                                    </label>
                                    <div class="select-with-custom">
                                        <select id="auth-region" name="authRegion" class="input-30char">
                                            <option value="https://auth.pingone.com">Global (auth.pingone.com)</option>
                                            <option value="https://auth.pingone.eu">Europe (auth.pingone.eu)</option>
                                            <option value="https://auth.pingone.ca">Canada (auth.pingone.ca)</option>
                                            <option value="https://auth.pingone.asia">Asia (auth.pingone.asia)</option>
                                            <option value="custom">Custom Domain</option>
                                        </select>
                                        <input type="text" id="custom-auth-url" name="customAuthUrl" class="input-30char" style="display: none; margin-top: 8px;" placeholder="https://your-custom-domain.com">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="base-url" class="with-tooltip">
                                        API Base URL
                                        <span class="tooltip-icon" data-tippy-content="The base URL for the PingOne API for your region. E.g. https://api.pingone.eu">i</span>
                                    </label>
                                    <input type="url" id="base-url" name="baseUrl" value="https://api.pingone.com" class="input-30char" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group form-row">
                            <label class="checkbox-label">
                                <input type="checkbox" id="use-client-secret" name="useClientSecret" checked disabled>
                                <span>Use Client Secret</span>
                                <span class="tooltip-icon" data-tippy-content="Check this if your PingOne application requires a client secret for authentication.">i</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="save-credentials" name="saveCredentials">
                                <span>Save Credentials</span>
                                <span class="tooltip-icon" data-tippy-content="Check this to save your credentials securely in the browser's local storage for future sessions.">i</span>
                            </label>
                        </div>

                        <div class="action-buttons centered">
                            <button type="button" id="test-credentials" class="btn-pill">
                                Test Credentials
                                <span id="test-credentials-loading" class="loading-spinner" style="display: none; margin-left: 8px;">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </span>
                            </button>
                            <div id="test-credentials-status" class="status-message" style="margin-left: 10px; display: inline-block; padding: 5px 10px; border-radius: 4px;"></div>

                        </div>
                    </form>
                </div>
            </section>

            <!-- Application Settings Group -->
            <section class="config-group">
                <div class="group-header">
                    <h2>Application Settings</h2>
                </div>
                <div class="group-content">
                    <form id="app-settings-form" class="form compact-form">
                        <div class="form-group">
                            <label for="default-file" class="with-tooltip">
                                Default CSV File
                                <span class="tooltip-icon" data-tippy-content="Select a CSV file to automatically load for import operations.">i</span>
                            </label>
                            <input type="file" id="default-file" name="defaultFile" accept=".csv" class="input-50char">
                            <div id="current-default-file" class="current-file-info"></div>
                        </div>
                    </form>
                    
                    <!-- File Information Section -->
                    <div id="file-info-container" class="file-info-container" style="display: none;">
                        <!-- Content will be dynamically generated by JavaScript -->
                    </div>
                    </div>
                </div>
            </section>

            <!-- Modify Attributes Selection -->
            <section class="config-group" id="modify-attributes-config">
                <div class="group-header">
                    <h2>Modify User Attributes</h2>
                </div>
                <div class="group-content">
                    <div class="csv-format-config">
                        <h4 class="config-title">When modifying users, update:</h4>
                        <div class="checkbox-grid-controls">
                            <label class="checkbox-label select-all-label">
                                <input type="checkbox" id="select-all-modify-fields">
                                <span>Select all/unselect all</span>
                                <span class="tooltip-icon" data-tippy-content="Toggle all user attributes below.">i</span>
                            </label>
                        </div>
                        <div id="modify-fields-grid" class="checkbox-grid">
                            <!-- Attributes will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Spacing after the last section -->
            <br>
            <br>

            <!-- Logging Configuration Group -->
            <section class="config-group" id="logging-config">
                <div class="group-header">
                    <h2>Logging Configuration</h2>
                </div>
                <div class="group-content">
                    <form id="logging-form" class="form compact-form">
                        <div class="form-group">
                            <div class="form-group">
                                <label for="log-file-path" class="with-tooltip">
                                    Log File Location
                                    <span class="tooltip-icon" data-tippy-content="Select where to save the log file on the server.">i</span>
                                </label>
                                <div class="input-with-button">
                                    <input type="text" id="log-file-path" class="form-control" placeholder="Select directory..." readonly>
                                    <button type="button" id="browse-button" class="btn btn-secondary">Browse</button>
                                    <input type="file" id="log-file-picker" style="display: none;" webkitdirectory directory>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="log-file-name" class="with-tooltip">
                                Log Filename
                                <span class="tooltip-icon" data-tippy-content="The name of the log file (must end with .log)">i</span>
                            </label>
                            <div class="input-with-button">
                                <input type="text" id="log-file-name" name="logFileName" class="input-30char" 
                                       value="import-status.log" placeholder="import-status.log">
                                <button type="button" id="update-log-file" class="btn-small" title="Update log file location">
                                    <i class="fas fa-save"></i> Save
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Current Log File</label>
                            <div class="file-display">
                                <span id="current-log-file" class="file-name">import-status.log</span>
                            </div>
                        </div>

                        <div class="logging-controls">
                            <div class="button-group">
                                <button type="button" id="start-logging-btn" class="btn-pill btn-success">
                                    <i class="fas fa-play"></i> Start Logging
                                </button>
                                <button type="button" id="stop-logging-btn" class="btn-pill btn-danger" style="display: none;">
                                    <i class="fas fa-stop"></i> Stop Logging
                                </button>
                            </div>
                            <div class="button-group">
                                <button type="button" id="export-log-btn" class="btn-pill">
                                    <i class="fas fa-download"></i> Export Log
                                </button>
                                <button type="button" id="clear-log-btn" class="btn-pill btn-warning">
                                    <i class="fas fa-trash"></i> Clear Log
                                </button>
                            </div>
                        </div>
                        
                        <div class="logging-status-container">
                            <div id="logging-status" class="status-display inactive">
                                <div class="status-content">
                                    <span class="status-label">Logging Status:</span>
                                    <span class="status-value">Inactive</span>
                                    <span class="status-icon">✗</span>
                                </div>
                                <div id="logging-loading" class="loading-spinner" style="display: none;">
                                    <div class="spinner"></div>
                                    <span>Saving changes...</span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </section>

        </main>
    </div>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
      <div class="footer-content">
        <div class="footer-logo">
          <img src="images/logo.png" alt="Ping Identity" class="footer-logo-img" width="120" height="40">
        </div>
        <nav class="footer-links" aria-label="Footer navigation">
          <ul class="footer-links-list">
            <li><a href="#" class="footer-link">Terms of Service</a></li>
            <li><span class="footer-separator" aria-hidden="true">|</span></li>
            <li><a href="#" class="footer-link">Privacy Policy</a></li>
            <li><span class="footer-separator" aria-hidden="true">|</span></li>
            <li><a href="#" class="footer-link">Support</a></li>
          </ul>
        </nav>
        <div class="footer-copyright">
          &copy; <span id="current-year">2023</span> Ping Identity. All rights reserved.
        </div>
      </div>
    </footer>

    <!-- Modal -->
    <div id="modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title"></h3>
                <button id="modal-close" class="modal-close">&times;</button>
            </div>
            <div id="modal-body" class="modal-body"></div>
            <div class="modal-footer">
                <button id="modal-confirm" class="btn-pill">OK</button>
                <button id="modal-cancel" class="btn-pill">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Spinner -->
    <div id="spinner" class="spinner hidden">
        <div class="spinner-content">
            <div class="spinner-icon"></div>
            <p id="spinner-text">Loading...</p>
            <button id="spinner-cancel" class="btn-pill spinner-cancel-btn">Cancel</button>
        </div>
    </div>
    <!-- External JavaScript (load synchronously in correct order) -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha512-6UofPqm0QupIL0kzS/UIzekR73/luZdC6i/kXDbWnLOJoqwklBK6519iUnShaYceJ0y4FaiPtX/hRnV/X/xlUQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.5.0/dist/axios.min.js"></script>
    <!-- Tippy.js -->
    <script src="https://unpkg.com/tippy.js@6.3.7/dist/tippy-bundle.umd.min.js"></script>
    
    <!-- Application Scripts (order matters) -->
    <script>
    // Set current year in footer
    document.getElementById('current-year').textContent = new Date().getFullYear();
    
    // Function to initialize the settings page
    function initializeSettingsPage() {
        console.log('=== SETTINGS PAGE INITIALIZATION STARTED ===');
        
        // Log loaded dependencies
        console.log('Loaded dependencies:', {
            Popper: typeof Popper !== 'undefined',
            axios: typeof axios !== 'undefined',
            tippy: typeof tippy !== 'undefined',
            utils: typeof window.utils !== 'undefined',
            SettingsPage: typeof SettingsPage !== 'undefined'
        });
        
        // Check if all required dependencies are loaded
        if (typeof window.utils === 'undefined') {
            console.error('Utils not loaded. Retrying in 100ms...');
            setTimeout(initializeSettingsPage, 100);
            return;
        }
        
        // Initialize settings page if on settings page
        if (document.getElementById('environment-id') && typeof SettingsPage !== 'undefined') {
            console.log('Initializing SettingsPage...');
            try {
                window.settingsPage = new SettingsPage();
                console.log('SettingsPage initialized successfully');
            } catch (error) {
                console.error('Error initializing SettingsPage:', error);
            }
        } else {
            console.warn('SettingsPage not initialized - required elements not found');
        }
    }
    
    // Add cache-busting parameter
    const cacheBuster = 'v=' + new Date().getTime();
    
    // Load utils-simple.js first
    const utilsScript = document.createElement('script');
    utilsScript.src = 'js/utils-simple.js?' + cacheBuster;
    utilsScript.onload = function() {
        console.log('utils-simple.js loaded');
        // Load settings.js after utils-simple.js is loaded
        const settingsScript = document.createElement('script');
        settingsScript.src = 'js/settings.js?' + cacheBuster;
        settingsScript.onload = function() {
            console.log('settings.js loaded');
            // Initialize the page after all scripts are loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeSettingsPage);
            } else {
                initializeSettingsPage();
            }
        };
        document.body.appendChild(settingsScript);
    };
    document.body.appendChild(utilsScript);
    </script>
</body>
</html>